Security Profile Change Requested for <%= @employee.cn %> on <%= l @emp_transaction.created_at, format: :verbose %>
=================================================

<% if @emp_transaction.security_profiles.count > 0 %>
<% if Application.for_emp_transaction(@emp_transaction).where('ad_controls IS FALSE').count == 0 %>
NO ACTION NEEDED -- FOR REVIEW ONLY

Permissions were automatically updated by Mezzo. Please review notes for any changes requested by the manager.
<% else %>
ACTION NEEDED

Please update access for the applications not controlled by Mezzo.
<% end %>

<% if @employee.emp_deltas.important_changes.present? %>
This security access change was requested after the following employee information was updated on <%= l @employee.emp_deltas.important_changes.last.created_at, format: :verbose %>:
<% @employee.emp_deltas.important_changes.last.format_by_key.each do |e| %>
- <%= e['name'] %> changed from <%= e['before'] %> to <%= e['after'] %>
<% end %>
<% end %>
<% else %>
NO CHANGES MADE. PLEASE REVIEW FOR MANAGER NOTES.
<% end %>

WORKER INFO
------------------
Name: <%= @employee.cn %>
Email: <%= @employee.email %>
Employee ID: <%= @employee.employee_id %>
Title: <%= @employee.job_title.try(:name) %>
Department: <%= @employee.department.name %>
Location: <%= @employee.location.name %>
Manager: <%= @manager.first_name %> <%= @manager.last_name %> - <%= @manager.email %>

<% if @emp_transaction.security_profiles.count > 0 %>
SECURITY PROFILE CHANGES
------------------

Apply Security Profiles:
------------------
<% @emp_transaction.security_profiles.each do |sp| %>
<%= sp.name %>
<% sp.access_levels.find_each do |al| %>
  - <%= al.name %> <%= al.application.name %>
    <% if(al.application.dependency.present? || al.application.onboard_instructions.present?) %>
      - <%= al.application.dependency %>
      - <%= al.application.onboard_instructions %>
    <% else %>
      No further action needed.
    <% end %>
  <% end %>
<% end %>
<% end %>
<% if @emp_transaction.revoked_security_profiles.count > 0 %>

Revoke Security Profiles:
------------------
<% @emp_transaction.revoked_security_profiles.each do |sp| %>
<%= sp.name %>
<% sp.access_levels.find_each do |al| %>
  - <%= al.name %> <%= al.application.name %>
    <% if(al.application.dependency.present? || al.application.offboard_instructions.present?) %>
      - <%= al.application.dependency %>
      - <%= al.application.offboard_instructions %>
    <% else %>
      No further action needed.
    <% end %>
  <% end %>
<% end %>
<% end %>

<% if @emp_transaction.kind == "Equipment" %>
Machine Bundle:
------------------
<% @emp_transaction.machine_bundles.each do |mb| %>
  <%= mb.name %>
    - <%= mb.description %>
<% end %>

<% if @employee.address.present? %>
  Shipping Address:

  Address 1: <%= @employee.address.line_1 if @employee.address.line_1.present? %>
  Address 2: <%= @employee.address.line_2 if @employee.address.line_2.present? %>
  Address 2: <%= @employee.address.line_3 if @employee.address.line_3.present? %>
  City: <%= @employee.address.city if @employee.address.city.present? %>
  State: <%= @employee.address.state_territory if @employee.address.state_territory.present? %>
  Zip: <%= @employee.address.postal_code if @employee.address.postal_code.present? %>
  Country: <%= @employee.address.country.name if @employee.address.country.name.present? %>
<% end %>
  Personal Mobile: <%= @employee.personal_mobile_phone if @employee.personal_mobile_phone.present? %>
<% end %>

ADDITIONAL INSTRUCTIONS
------------------
<% if @emp_transaction.notes.present? %>
<%= @emp_transaction.notes %>
<% else %>
None.
<% end %>
